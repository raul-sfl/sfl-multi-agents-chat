<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stayforlong ‚Äì Demo Chat Widget</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f4f6f9;
      color: #1a1a2e;
    }

    /* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
    .hero {
      background: linear-gradient(135deg, #c40a4c 0%, #f60e5f 100%);
      color: #fff;
      padding: 64px 24px 80px;
      text-align: center;
    }
    .hero-logo {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 24px;
    }
    .hero-logo svg { width: 40px; height: 40px; }
    .hero-logo span {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    .hero h1 { font-size: 2rem; font-weight: 700; margin-bottom: 6px; }
    .hero-subtitle { font-size: 1rem; font-weight: 400; opacity: 0.75; margin-bottom: 10px; letter-spacing: 0.02em; }
    .hero p { font-size: 1.05rem; opacity: 0.85; max-width: 540px; margin: 0 auto; }

    /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
    .container { max-width: 860px; margin: -32px auto 64px; padding: 0 20px; }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 28px 32px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    }
    .card h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 6px; color: #c40a4c; }
    .card p  { font-size: 0.9rem; color: #555; margin-bottom: 16px; line-height: 1.5; }

    /* ‚îÄ‚îÄ Info banner ‚îÄ‚îÄ */
    .info-banner {
      background: #e8f4f8;
      border-left: 4px solid #f60e5f;
      border-radius: 8px;
      padding: 14px 18px;
      font-size: 0.88rem;
      line-height: 1.6;
      color: #444;
      margin-bottom: 24px;
    }
    .info-banner strong { color: #c40a4c; }

    /* ‚îÄ‚îÄ Scenario buttons ‚îÄ‚îÄ */
    .scenarios { display: flex; flex-wrap: wrap; gap: 10px; }
    .scenario-btn {
      padding: 10px 18px;
      border: 2px solid #f60e5f;
      background: #fff;
      color: #f60e5f;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      transition: background 0.15s, color 0.15s;
      font-family: inherit;
    }
    .scenario-btn:hover { background: #f60e5f; color: #fff; }
    .scenario-btn .icon { margin-right: 6px; }

    /* ‚îÄ‚îÄ Mock data table ‚îÄ‚îÄ */
    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
    th {
      text-align: left;
      padding: 8px 12px;
      background: #f0f4f8;
      color: #c40a4c;
      font-weight: 600;
    }
    td { padding: 8px 12px; border-bottom: 1px solid #eee; }
    tr:last-child td { border-bottom: none; }
    code {
      background: #eef2f7;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 0.82rem;
      font-family: "SF Mono", "Fira Code", monospace;
      color: #c40a4c;
    }

    /* ‚îÄ‚îÄ GTM snippet ‚îÄ‚îÄ */
    pre {
      background: #1a1a2e;
      color: #a8d8ea;
      padding: 18px;
      border-radius: 10px;
      font-size: 0.82rem;
      overflow-x: auto;
      line-height: 1.6;
    }
    pre .comment { color: #6a9fb5; }
    pre .key     { color: #f7c59f; }
    pre .val     { color: #a8d8ea; }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    .footer {
      text-align: center;
      font-size: 0.8rem;
      color: #999;
      padding: 24px;
    }
  </style>
</head>
<body>

  <div class="hero">
    <div class="hero-logo">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M33.7972 11.3189C35.1301 8.45251 35.8544 5.62233 35.8544 4H30.0904C30.0904 4.66107 29.8691 5.63393 29.487 6.73012C23.9798 3.35441 19.695 4.71463 17.4289 7.2937C14.7363 10.3582 14.722 15.2039 17.3989 17.8753C19.4651 19.9411 21.5216 20.5409 23.2183 20.5409C24.2034 20.536 25.1781 20.3413 26.0878 19.9676C27.2209 19.5073 28.2704 18.7901 29.2291 17.9056C29.2748 18.4757 29.2944 19.0586 29.2944 19.6487C29.2944 24.9676 26.018 29.6073 20 29.6073C14.05 29.6073 10.7076 24.9676 10.7076 19.6487C10.7076 16.4389 11.9589 13.466 14.2831 11.632L10.8591 6.51257C6.48359 9.3079 4.00195 14.1574 4.00195 19.6487C4.00195 28.1845 10.0676 35.3593 20.002 35.3593C29.9363 35.3593 36.002 28.1845 36.002 19.6487C35.9974 16.5938 35.2307 13.7359 33.7972 11.3189ZM23.7851 16.1523C23.0657 16.1523 22.3624 15.9414 21.7642 15.5463C21.166 15.1511 20.6998 14.5895 20.4245 13.9325C20.1492 13.2754 20.0771 12.5524 20.2175 11.8549C20.3578 11.1574 20.7043 10.5167 21.213 10.0138C21.7217 9.51089 22.3699 9.16842 23.0755 9.02967C23.7811 8.89092 24.5125 8.96213 25.1772 9.2343C25.8419 9.50646 26.41 9.96735 26.8097 10.5587C27.2094 11.15 27.4227 11.8452 27.4227 12.5564C27.4227 13.5101 27.0395 14.4247 26.3573 15.0991C25.6751 15.7734 24.7499 16.1523 23.7851 16.1523Z" fill="white"/><path opacity="0.25" d="M29.1752 17.9482C30.5159 16.4266 33.3698 12.4609 33.7982 11.3143C34.6662 12.805 36.0134 15.5274 35.9984 19.8327C35.9938 21.1051 28.8911 22.9656 29.0799 21.9469C29.394 20.2536 29.2849 18.5473 29.1752 17.9482Z" fill="url(#paint0_linear)" style="mix-blend-mode: multiply;"/><defs><linearGradient id="paint0_linear" x1="29.6617" y1="14.0832" x2="34.426" y2="21.2019" gradientUnits="userSpaceOnUse"><stop stop-color="#212120"/><stop offset="0.2" stop-color="#212120" stop-opacity="0.72"/><stop offset="0.51" stop-color="#212120" stop-opacity="0"/></linearGradient></defs></svg>
      <span>stayforlong</span>
    </div>
    <h1>Chat Widget PoC</h1>
    <p>Demo of the multi-agent AI assistant deployable via Google Tag Manager</p>
  </div>

  <div class="container">

    <div class="info-banner">
      <strong>Demo mode:</strong> This page simulates stayforlong.com with the widget loaded via GTM.
      The chat connects to <code>ws://localhost:8000/ws</code>. Make sure the backend is running:
      <code>cd backend &amp;&amp; uvicorn main:app --port 8000 --reload</code>
    </div>

    <!-- Scenario buttons -->
    <div class="card">
      <h2>Test scenarios</h2>
      <p>Click to open the chat with a pre-filled test message.</p>
      <div class="scenarios">
        <button class="scenario-btn" onclick="triggerScenario('booking')">
          <span class="icon">üîç</span> Check booking SFL-2024-001
        </button>
        <button class="scenario-btn" onclick="triggerScenario('booking_email')">
          <span class="icon">üìß</span> Search by email
        </button>
        <button class="scenario-btn" onclick="triggerScenario('incident')">
          <span class="icon">üîß</span> Report an incident
        </button>
        <button class="scenario-btn" onclick="triggerScenario('escalate')">
          <span class="icon">üö®</span> Escalate to human agent
        </button>
        <button class="scenario-btn" onclick="triggerScenario('property_bcn')">
          <span class="icon">üè®</span> Barcelona amenities
        </button>
        <button class="scenario-btn" onclick="triggerScenario('checkin')">
          <span class="icon">üïê</span> Check-in time Madrid
        </button>
      </div>
    </div>

    <!-- Mock data reference -->
    <div class="card">
      <h2>Available test data</h2>
      <p>These are the mock data entries the system recognises:</p>
      <table>
        <tr>
          <th>Type</th>
          <th>ID / Email</th>
          <th>Description</th>
          <th>Status</th>
        </tr>
        <tr>
          <td>Booking</td>
          <td><code>SFL-2024-001</code></td>
          <td>Carlos Martinez ‚Äì Gran Via Barcelona (28 nights)</td>
          <td>confirmed</td>
        </tr>
        <tr>
          <td>Booking</td>
          <td><code>SFL-2024-002</code></td>
          <td>Sophie Dubois ‚Äì Salamanca Madrid (28 nights)</td>
          <td>checked_in</td>
        </tr>
        <tr>
          <td>Booking</td>
          <td><code>SFL-2024-003</code></td>
          <td>James Wilson ‚Äì LX Factory Lisbon (29 nights)</td>
          <td>pending</td>
        </tr>
        <tr>
          <td>Email</td>
          <td><code>carlos.m@email.com</code></td>
          <td>‚Üí SFL-2024-001</td>
          <td>‚Äì</td>
        </tr>
        <tr>
          <td>Ticket</td>
          <td><code>INC-001</code></td>
          <td>Hot water ‚Äì MAD Salamanca</td>
          <td>in_progress</td>
        </tr>
        <tr>
          <td>Ticket</td>
          <td><code>INC-002</code></td>
          <td>Neighbor noise ‚Äì BCN Gran Via</td>
          <td>resolved</td>
        </tr>
        <tr>
          <td>Property</td>
          <td><code>PROP-BCN-001</code></td>
          <td>Apartamentos Gran Via Barcelona</td>
          <td>4‚òÖ</td>
        </tr>
        <tr>
          <td>Property</td>
          <td><code>PROP-MAD-003</code></td>
          <td>Residencia Salamanca Madrid</td>
          <td>4‚òÖ</td>
        </tr>
        <tr>
          <td>Property</td>
          <td><code>PROP-LIS-002</code></td>
          <td>LX Factory Residences Lisbon</td>
          <td>3‚òÖ</td>
        </tr>
      </table>
    </div>

    <!-- GTM snippet -->
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <h2 style="margin:0;">GTM injection code</h2>
        <button id="gtm-copy-btn" style="background:#f60e5f;color:#fff;border:none;border-radius:6px;padding:6px 14px;font-size:13px;cursor:pointer;font-weight:600;">Copy</button>
      </div>
      <p>Add this as a <strong>Custom HTML tag</strong> in Google Tag Manager (trigger: All Pages):</p>
      <pre id="gtm-snippet-code" style="white-space:pre-wrap;word-break:break-all;"></pre>
    </div>

  </div>

  <div class="footer">
    Stayforlong Chat Widget PoC ‚Äî Multi-agent AI (Gemini) via GTM
  </div>

  <!-- ‚îÄ‚îÄ Widget configuration (simulating GTM injection) ‚îÄ‚îÄ -->
  <script>
    // Set SFL_BACKEND_URL to point to your sfl-multi-agents-adk instance.
    // In production this should be your deployed backend URL (https/wss).
    // Locally: defaults to localhost:8000 (sfl-multi-agents-adk default port).
    var _backendHost = window.SFL_BACKEND_URL || (window.location.protocol === 'https:' ? 'https://localhost:8000' : 'http://localhost:8000');
    var _wsBase = _backendHost.replace(/^http/, 'ws').replace(/\/$/, '');
    window.StayforlongChat = {
      wsUrl: _wsBase + '/ws',
      accentColor: '#f60e5f',
      secondaryColor: '#c40a4c',
      // contextVars: GTM variable values forwarded as extra WS query params
      contextVars: {
        // user_id:    '{{User ID}}',       // uncomment and set in GTM
        // booking_id: '{{Booking ID}}',
      },
    };
  </script>
  <script src="./sfl-chat-widget.js"></script>

  <!-- ‚îÄ‚îÄ Scenario helpers ‚îÄ‚îÄ -->
  <script>
    var SCENARIOS = {
      booking:       'Hi, I need to check my booking SFL-2024-001',
      booking_email: 'Find my bookings with the email carlos.m@email.com',
      incident:      'There is a problem with the hot water in my room, my booking is SFL-2024-002',
      escalate:      "I've been waiting 3 hours for the repair and nobody has shown up, I need to speak to someone",
      property_bcn:  'What amenities does the Gran Via apartment in Barcelona have?',
      checkin:       'What time is check-in at Residencia Salamanca in Madrid?',
    };

    function triggerScenario(key) {
      var host = document.getElementById('sfl-chat-host');
      if (!host || !host.shadowRoot) {
        alert('The widget has not loaded yet. Please wait a moment and try again.');
        return;
      }
      var shadow = host.shadowRoot;
      var window_el = shadow.getElementById('sfl-window');
      var btn = shadow.getElementById('sfl-btn');
      var input = shadow.getElementById('sfl-input');

      // Open chat if not open
      if (!window_el.classList.contains('open')) {
        btn.click();
        // Wait a tick for connection, then fill input
        setTimeout(function() { fillAndFocus(shadow, input, key); }, 300);
      } else {
        fillAndFocus(shadow, input, key);
      }
    }

    function fillAndFocus(shadow, input, key) {
      input.value = SCENARIOS[key] || '';
      // Trigger resize
      input.style.height = 'auto';
      input.style.height = Math.min(input.scrollHeight, 120) + 'px';
      input.focus();
    }
  </script>

  <!-- Dynamic GTM snippet: URLs based on current host -->
  <script>
    (function () {
      var wsProto = location.protocol === 'https:' ? 'wss:' : 'ws:';
      var httpProto = location.protocol;
      var host = location.host || 'localhost:8000';
      var wsUrl  = wsProto  + '//' + host + '/ws';
      var jsUrl  = httpProto + '//' + host + '/static/sfl-chat-widget.js';

      var snippet =
        '<!-- Stayforlong Chat Widget -->\n' +
        '<script>\n' +
        '  window.StayforlongChat = {\n' +
        '    wsUrl:       \'' + wsUrl + '\',\n' +
        '    accentColor: \'#f60e5f\',\n' +
        '  };\n' +
        '<\/script>\n' +
        '<script src="' + jsUrl + '"><\/script>';

      var pre = document.getElementById('gtm-snippet-code');
      if (pre) pre.textContent = snippet;

      var btn = document.getElementById('gtm-copy-btn');
      if (btn) {
        btn.addEventListener('click', function () {
          navigator.clipboard.writeText(snippet).then(function () {
            btn.textContent = 'Copied!';
            setTimeout(function () { btn.textContent = 'Copy'; }, 2000);
          });
        });
      }
    })();
  </script>

</body>
</html>
